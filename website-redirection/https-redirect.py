from http.server import HTTPServer, BaseHTTPRequestHandler
import requests
from requests.structures import CaseInsensitiveDict
# import BaseHTTPServer, SimpleHTTPServer
import ssl

ip="google.com"
port=80
localip="192.168.1.1"
localport=443

class MyHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        # send 200 response
        self.send_response(200)
        # send response headers
        self.end_headers()
        # send the body of the response
        url = "http://"+ip+":"+str(port)+"/"+self.path
        headers = CaseInsensitiveDict()
        headers["Access-Control-Allow-Origin"] = "*"

        r = str(requests.get(url, headers=headers).text)

        r = r.replace(ip, localip+":"+str(localport))
        r = r.replace(ip+":"+str(port), localip+":"+str(localport))


        self.wfile.write(bytes(r, "utf-8"))

httpd = HTTPServer(('0.0.0.0', localport), MyHandler)
# httpd.serve_forever()

# httpd = BaseHTTPServer.HTTPServer(('localhost', 4443), SimpleHTTPServer.SimpleHTTPRequestHandler)
httpd.socket = ssl.wrap_socket (httpd.socket, certfile='./your_ssl.pem', server_side=True)
httpd.serve_forever()
